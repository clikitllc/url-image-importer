<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Progress Bar Test</title>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
	<div class="container mt-5">
		<h1>URL Image Importer Progress Bar Test</h1>
		
		<!-- URL Import Test -->
		<div class="card mb-4">
			<div class="card-header">
				<h5>URL Import Test</h5>
			</div>
			<div class="card-body">
				<form id="test-url-form">
					<div class="mb-3">
						<label for="test_url" class="form-label">Image URL</label>
						<input type="url" class="form-control" id="test_url" placeholder="https://example.com/image.jpg">
					</div>
					<button type="submit" class="btn btn-primary" id="start-url-test">Start URL Import</button>
				</form>
				
				<!-- Progress Bar for URL -->
				<div id="url-progress-container" style="display: none; margin-top: 20px;">
					<div class="d-flex justify-content-between align-items-center mb-2">
						<small id="url-progress-text" class="text-muted">Starting import...</small>
						<small id="url-progress-count" class="text-muted">0/0</small>
					</div>
					<div class="progress-bar-container" style="background: #f1f1f1; border-radius: 4px; height: 20px; margin: 10px 0;">
						<div id="url-progress-bar" style="background: #0073aa; height: 100%; width: 0%; border-radius: 4px; transition: width 0.3s;"></div>
					</div>
					<div class="text-end mt-2">
						<button type="button" class="btn btn-sm btn-outline-danger" id="cancel-url-import">Cancel Import</button>
					</div>
					<div id="url-import-results" style="margin-top: 15px;"></div>
				</div>
			</div>
		</div>

		<!-- Test Results -->
		<div class="card">
			<div class="card-header">
				<h5>Test Results</h5>
			</div>
			<div class="card-body">
				<div id="test-results"></div>
			</div>
		</div>
	</div>

	<script>
	jQuery(document).ready(function($) {
		var importCanceled = false;
		
		// Mock AJAX data (normally from WordPress)
		var uimptr_ajax = {
			ajax_url: '#', // This would be the WordPress AJAX URL
			nonce: 'test-nonce'
		};
		
		function updateProgress(type, current, total, message) {
			var percent = total > 0 ? Math.round((current / total) * 100) : 0;
			
			$('#' + type + '-progress-bar').css('width', percent + '%');
			$('#' + type + '-progress-text').text(message);
			$('#' + type + '-progress-count').text(current + '/' + total);
		}
		
		function cancelImport(type) {
			importCanceled = true;
			$('#' + type + '-progress-text').text('Import canceled by user.');
			$('#cancel-' + type + '-import').prop('disabled', true);
			$('#start-' + type + '-test').prop('disabled', false);
		}
		
		function simulateImport(urls) {
			$('#url-progress-container').show();
			$('#start-url-test').prop('disabled', true);
			importCanceled = false;
			
			var total = urls.length;
			var current = 0;
			var results = [];
			
			function processNext() {
				if (importCanceled || current >= total) {
					// Finished
					$('#url-progress-text').text(importCanceled ? 'Import canceled.' : 'Import completed!');
					$('#start-url-test').prop('disabled', false);
					$('#cancel-url-import').prop('disabled', false);
					
					// Show results
					if (results.length > 0) {
						$('#url-import-results').html('<div class="alert alert-success">Simulated results:<ul>' + 
							results.map(function(r) { return '<li>' + r + '</li>'; }).join('') + 
							'</ul></div>');
					}
					return;
				}
				
				var url = urls[current];
				updateProgress('url', current, total, 'Processing: ' + url);
				
				// Simulate processing time
				setTimeout(function() {
					current++;
					results.push('Successfully processed: ' + url);
					
					setTimeout(processNext, 200); // Small delay between items
				}, Math.random() * 1000 + 500); // Random delay 0.5-1.5s
			}
			
			processNext();
		}
		
		// Test form submission
		$('#test-url-form').on('submit', function(e) {
			e.preventDefault();
			
			var url = $('#test_url').val().trim();
			if (!url) {
				alert('Please enter a URL');
				return;
			}
			
			// Clear previous results
			$('#url-import-results').empty();
			$('#test-results').html('<div class="alert alert-info">Running progress bar test...</div>');
			
			// Simulate multiple URLs for testing
			var testUrls = [url];
			if (url.includes('test-multiple')) {
				testUrls = [
					'https://example.com/image1.jpg',
					'https://example.com/image2.jpg',
					'https://example.com/image3.jpg',
					'https://example.com/image4.jpg',
					'https://example.com/image5.jpg'
				];
			}
			
			simulateImport(testUrls);
		});
		
		// Cancel button
		$('#cancel-url-import').click(function() {
			cancelImport('url');
		});
		
		$('#test-results').html('<div class="alert alert-success">Progress bar test ready! Enter a URL and click "Start URL Import" to test the progress bar functionality. Use "test-multiple" as the URL to simulate importing multiple images.</div>');
	});
	</script>
</body>
</html>